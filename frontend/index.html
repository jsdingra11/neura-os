<!DOCTYPE html>
<html lang="en" data-theme="dark" style="scroll-behavior: smooth;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neura OS â€” Marble Horizon (Enhanced)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);

            /* --- LIGHT THEME VARIABLES --- */
            --light-bg-start: #f0f3f6;
            --light-bg-mid: #e0e5ec;
            --light-bg-end: #d8e2e8;
            --light-surface: #e8edf2;
            --light-surface-alt: #dfe5ed;
            --light-border: #cdd4db;
            --light-text-primary: #000000;
            /* FIXED: Pure Black for max contrast */
            --light-text-secondary: #333333;
            /* FIXED: Dark gray secondary text */
            --light-accent: #6d8aae;
            --light-accent-glow: rgba(109, 138, 174, 0.7);
            --light-shadow-soft: rgba(95, 115, 140, 0.15);
            --light-emboss-shadow: rgba(0, 0, 0, 0.07);
            --light-surface-glass: rgba(255, 255, 255, 0.8);
            /* FIXED: Increased opacity for better text contrast */
            --light-border-glass: rgba(255, 255, 255, 0.6);
            --light-shadow-glass: rgba(0, 0, 0, 0.15);
            --light-window-focus-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
            --light-window-focus-border: var(--light-accent);
            --light-terminal-prompt: #4CAF50;

            /* --- DARK THEME VARIABLES --- */
            --dark-bg-start: #252932;
            --dark-bg-mid: #1e2129;
            --dark-bg-end: #1a1c23;
            --dark-surface: #2a2e38;
            --dark-surface-alt: #313541;
            --dark-border: #3f4452;
            --dark-text-primary: #e1e3e8;
            --dark-text-secondary: #9098a7;
            --dark-accent: #78dce8;
            --dark-accent-glow: rgba(120, 220, 232, 0.7);
            --dark-shadow-soft: rgba(0, 0, 0, 0.2);
            --dark-emboss-shadow: rgba(0, 0, 0, 0.2);
            --dark-surface-glass: rgba(42, 46, 56, 0.6);
            --dark-border-glass: rgba(255, 255, 255, 0.1);
            --dark-shadow-glass: rgba(0, 0, 0, 0.3);
            --dark-window-focus-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --dark-window-focus-border: var(--dark-accent);
            --dark-terminal-prompt: #78dce8;

            /* --- CURRENT THEME MAPPING --- */
            --c-bg: var(--light-bg-start);
            --c-surface: var(--light-surface-glass);
            --c-surface-alt: var(--light-surface-alt);
            --c-border: var(--light-border-glass);
            --c-text-primary: var(--light-text-primary);
            --c-text-secondary: var(--light-text-secondary);
            --c-accent: var(--light-accent);
            --c-accent-glow: var(--light-accent-glow);
            --c-shadow-soft: var(--light-shadow-soft);
            --c-emboss-shadow: var(--light-emboss-shadow);
            --c-shadow-glass: var(--light-shadow-glass);
            --c-window-focus-shadow: var(--light-window-focus-shadow);
            --c-window-focus-border: var(--light-window-focus-border);
            --c-terminal-prompt: var(--light-terminal-prompt);
        }

        [data-theme="dark"] {
            --c-bg: var(--dark-bg-start);
            --c-surface: var(--dark-surface-glass);
            --c-surface-alt: var(--dark-surface-alt);
            --c-border: var(--dark-border-glass);
            --c-text-primary: var(--dark-text-primary);
            --c-text-secondary: var(--dark-text-secondary);
            --c-accent: var(--dark-accent);
            --c-accent-glow: var(--dark-accent-glow);
            --c-shadow-soft: var(--dark-shadow-soft);
            --c-emboss-shadow: var(--dark-emboss-shadow);
            --c-shadow-glass: var(--dark-shadow-glass);
            --c-window-focus-shadow: var(--dark-window-focus-shadow);
            --c-window-focus-border: var(--dark-window-focus-border);
            --dark-terminal-prompt: #78dce8;
        }

        /* Define image URLs and colors as CSS Variables for easier JS lookup */
        :root {
            --bg-1-url: url('https://source.unsplash.com/1600x900/?dark-abstract');
            --bg-2-url: url('https://source.unsplash.com/1600x900/?mountain,space');
            --bg-3-url: url('https://source.unsplash.com/1600x900/?cityscape,night');
            --bg-4-url: url('https://source.unsplash.com/1600x900/?minimal,pastel');
        }

        /* DEFAULT WALLPAPER STYLES (Dark is default) */
        body {
            background-color: var(--c-bg);
            transition: background-color 0.4s var(--ease-out-quad), background-image 0s;
            background-size: cover;
            background-position: center;
        }

        [data-theme="light"] body {
            background-image: var(--bg-1-url);
        }

        body[data-wallpaper="custom"] {
            background-size: cover !important;
            background-position: center !important;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            color: var(--c-text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            cursor: default;
        }

        body {
            cursor: url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.1" d="M10.448 17.184L8.09782 10.6557C7.52461 9.06344 9.06479 7.52326 10.657 8.09647L17.1853 10.4467C19.1195 11.143 18.8709 13.9539 16.8445 14.2999L16.0686 14.4324C15.2319 14.5752 14.5766 15.2306 14.4337 16.0672L14.3013 16.8431C13.9553 18.8699 11.1443 19.1185 10.448 17.184Z" fill="%23000000"/><path d="M10.4465 17.1843L8.09636 10.656C7.52315 9.0638 9.06333 7.52363 10.6556 8.09684L17.1839 10.447C19.118 11.1433 18.8694 13.9543 16.843 14.3003L16.0671 14.4327C15.2305 14.5756 14.5751 15.231 14.4323 16.0676L14.2998 16.8435C13.9538 18.8699 11.1428 19.1185 10.4465 17.1843Z" stroke="%23e1e3e8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'), default;
        }

        [data-theme="light"] body {
            cursor: url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.1" d="M10.448 17.184L8.09782 10.6557C7.52461 9.06344 9.06479 7.52326 10.657 8.09647L17.1853 10.4467C19.1195 11.143 18.8709 13.9539 16.8445 14.2999L16.0686 14.4324C15.2319 14.5752 14.5766 15.2306 14.4337 16.0672L14.3013 16.8431C13.9553 18.8699 11.1443 19.1185 10.448 17.184Z" fill="%23FFFFFF"/><path d="M10.4465 17.1843L8.09636 10.656C7.52315 9.0638 9.06333 7.52363 10.6556 8.09684L17.1839 10.447C19.118 11.1433 18.8694 13.9543 16.843 14.3003L16.0671 14.4327C15.2305 14.5756 14.5751 15.231 14.4323 16.0676L14.2998 16.8435C13.9538 18.8699 11.1428 19.1185 10.4465 17.1843Z" stroke="%23323232" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'), default;
        }

        body.is-dragging,
        body[style*="user-select: none"] {
            user-select: none;
            -webkit-user-select: none;
            cursor: grabbing !important;
        }

        #desktop {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            height: 12px;
            background: none;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            transition: all 0.4s var(--ease-out-back), box-shadow 0.2s ease;
            box-shadow: none;
            z-index: 10000;
        }

        #notch::before {
            content: '';
            position: absolute;
            inset: 0;
            background-color: var(--c-surface);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--c-border);
            border-top: none;
            box-shadow: 0 4px 12px var(--c-shadow-glass);
            transition: all 0.4s var(--ease-out-back);
        }

        #notch::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: var(--c-accent-glow);
            border-radius: 3px;
            box-shadow: 0 0 8px 1px var(--c-accent-glow);
            transition: opacity 0.3s ease-in-out, background 0.4s var(--ease-out-quad), box-shadow 0.4s var(--ease-out-quad);
            opacity: 1;
            z-index: 1;
        }

        #notch:hover {
            width: 600px;
            height: 52px;
        }

        #notch:hover::before {
            height: 52px;
            box-shadow: 0 8px 25px var(--c-shadow-glass);
        }

        #notch:hover::after {
            opacity: 0;
        }

        #notch-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            height: 100%;
            padding: 0 24px;
            opacity: 0;
            transition: opacity 0.2s ease 0.1s;
            position: relative;
            z-index: 2;
        }

        #notch:hover #notch-content {
            opacity: 1;
        }

        .notch-controls,
        .notch-status {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notch-controls svg,
        .notch-status svg {
            width: 20px;
            height: 20px;
            color: var(--c-text-secondary);
            transition: color 0.2s ease;
        }

        .notch-controls button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notch-controls button:hover svg {
            color: var(--c-accent);
        }

        #clock {
            font-size: 14px;
            font-weight: 500;
            color: var(--c-text-primary);
            width: 60px;
            text-align: center;
        }

        #power-container {
            position: relative;
        }

        #power-button {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background-color: var(--c-surface-alt);
            border: 1px solid var(--c-border);
            box-shadow: 2px 2px 5px var(--c-shadow-soft), inset -2px -2px 5px var(--c-emboss-shadow);
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            z-index: 10002;
            position: relative;
        }

        #power-button:hover {
            box-shadow: 0 0 0 2px var(--c-accent-glow);
        }

        #power-button svg {
            color: var(--c-text-secondary);
            width: 16px;
            height: 16px;
        }

        #power-menu-dropdown {
            position: absolute;
            top: 40px;
            right: 0;
            width: 150px;
            padding: 8px;
            border-radius: 12px;
            background-color: var(--c-surface);
            border: 1px solid var(--c-border);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 20px var(--c-shadow-glass);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 10001;
            pointer-events: none;
        }

        #power-menu-dropdown.is-open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            pointer-events: all;
        }

        #power-menu-dropdown .menu-item {
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--c-text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.15s;
        }

        #power-menu-dropdown .menu-item:hover {
            background-color: rgba(120, 220, 232, 0.15);
        }

        #power-menu-dropdown .menu-item svg {
            width: 16px;
            height: 16px;
            color: var(--c-text-secondary);
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            width: 160px;
            height: 32px;
            border-radius: 16px;
            border: 1px solid var(--c-border);
            background-color: transparent;
            padding: 0 12px 0 32px;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            color: var(--c-text-primary);
            transition: all 0.2s var(--ease-out-quad);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            box-shadow: 0 1px 3px var(--c-shadow-glass) inset;
            position: relative;
            z-index: 1;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--c-accent);
            box-shadow: 0 0 0 2px var(--c-accent-glow);
            width: 180px;
        }

        .search-bar svg {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            color: var(--c-text-secondary);
            z-index: 2;
        }

        #desktop-icons {
            position: absolute;
            top: 100px;
            left: 50px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            width: 90px;
            text-align: center;
            transition: transform 0.2s var(--ease-out-quad);
        }

        .desktop-icon:hover {
            transform: translateY(-4px);
        }

        .icon-glyph {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: box-shadow 0.2s var(--ease-out-quad);

            background-color: var(--c-surface);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--c-border);
            box-shadow: 0 2px 5px var(--c-shadow-glass);
        }

        .desktop-icon:hover .icon-glyph {
            box-shadow: 0 10px 20px -5px var(--c-shadow-glass), 0 0 0 1px var(--c-accent);
        }

        .icon-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--c-text-primary);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        [data-theme="dark"] .icon-label {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        #windows-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .window {
            position: absolute;
            width: 70vw;
            max-width: 800px;
            height: 60vh;
            max-height: 600px;

            background-color: var(--c-surface);
            border: 1px solid var(--c-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px -10px var(--c-shadow-glass), inset 0 0 0 1px rgba(255, 255, 255, 0.15);

            border-radius: 16px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(-110%) scale(0.8);
            transform-origin: top center;
            transition: opacity 0.4s ease, transform 0.5s var(--ease-out-back);

            pointer-events: auto;
            visibility: hidden;
            resize: both;
            overflow: hidden;
            min-width: 300px;
            min-height: 200px;
            left: 50%;
            top: 50%;
        }

        .window.is-open {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease, transform 0.5s var(--ease-out-back), width 0.3s ease, height 0.3s ease, border-radius 0.3s ease, left 0.3s ease, top 0.3s ease;
        }

        .window.is-dragging {
            transition: opacity 0.4s ease, transform 0s, width 0.3s ease, height 0.3s ease, border-radius 0.3s ease, left 0.3s ease, top 0.3s ease;
        }

        .window.is-open.is-focused {
            box-shadow: var(--c-window-focus-shadow), 0 0 0 1px var(--c-window-focus-border);
            border-color: var(--c-window-focus-border);
        }

        .window.is-maximized,
        .window.is-snapped-left,
        .window.is-snapped-right {
            max-width: 100vw !important;
            max-height: 100vh !important;
            border-radius: 0;
            left: 0 !important;
            top: 0 !important;
            transform: translate(0, 0) scale(1) !important;
            resize: none;
        }

        .window.is-maximized {
            width: 100vw !important;
            height: 100vh !important;
        }

        .window.is-snapped-left,
        .window.is-snapped-right {
            width: 50vw !important;
            height: 100vh !important;
        }

        .window.is-snapped-right {
            left: 50vw !important;
        }

        .window.is-minimized {
            opacity: 0;
            visibility: hidden;
            transform: translateY(100vh) scale(0.5) !important;
            transition: all 0.3s ease;
        }

        .window.is-closing {
            opacity: 0;
            transform: translateY(-110%) scale(0.8);
            transition: transform 0.4s var(--ease-out-quad), opacity 0.3s ease;
        }

        .window-header {
            display: flex;
            align-items: center;
            padding: 0 12px;
            height: 40px;
            flex-shrink: 0;
            cursor: move;
            user-select: none;
            border-bottom: 1px solid var(--c-border);
            pointer-events: all;
        }

        .window-header .window-controls {
            pointer-events: all;
        }

        .terminal-content {
            background-color: rgba(0, 0, 0, 0.8);
            color: #e1e3e8;
            font-family: monospace;
            padding: 10px;
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            white-space: pre-wrap;
        }

        .terminal-output {
            flex-grow: 1;
            overflow-y: auto;
        }

        .terminal-line {
            line-height: 1.4;
            word-break: break-all;
        }

        .terminal-prompt {
            color: var(--c-terminal-prompt);
            display: inline-block;
        }

        .terminal-input-line {
            display: flex;
            flex-shrink: 0;
            align-items: center;
            margin-top: 5px;
        }

        #terminal-input {
            background: none;
            border: none;
            color: #e1e3e8;
            font-family: monospace;
            font-size: 1em;
            width: 100%;
            outline: none;
            caret-color: #e1e3e8;
            padding-left: 0;
        }

        .files-toolbar {
            padding: 8px 20px;
            border-bottom: 1px solid var(--c-border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .files-toolbar button {
            background: none;
            border: none;
            color: var(--c-text-secondary);
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s;
            line-height: 1;
        }

        .files-toolbar button:disabled {
            color: var(--c-text-secondary);
            opacity: 0.4;
            cursor: default;
        }

        .files-toolbar button:hover:not(:disabled) {
            color: var(--c-text-primary);
        }

        #files-breadcrumb {
            font-size: 13px;
            font-weight: 500;
            color: var(--c-text-primary);
            flex-grow: 1;
        }

        #files-breadcrumb span {
            cursor: pointer;
            color: var(--c-accent);
        }

        #files-breadcrumb span:not(:last-child)::after {
            content: ' / ';
            color: var(--c-text-secondary);
        }

        .files-list {
            padding: 10px 0;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 6px 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.1s;
        }

        .file-item:hover {
            background-color: rgba(120, 220, 232, 0.1);
        }

        .file-item svg {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            color: var(--c-text-secondary);
        }

        .file-item[data-type="folder"] svg {
            color: var(--c-accent);
        }

        #dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 16px;
            background-color: var(--c-surface);
            border: 1px solid var(--c-border);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px var(--c-shadow-glass);
            z-index: 9999;
        }

        .dock-separator {
            width: 1px;
            height: 30px;
            background: var(--c-border);
            margin: 0 8px;
            opacity: 0.7;
        }

        #start-menu-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s var(--ease-out-quad);
            background-color: var(--c-surface);
            border: 1px solid var(--c-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 8px var(--c-shadow-glass);
            position: relative;
        }

        #start-menu-btn:hover,
        #start-menu-btn.is-active {
            box-shadow: 0 0 0 3px var(--c-accent-glow), 0 4px 8px var(--c-shadow-glass);
            transform: scale(1.05);
        }

        #start-menu-btn svg {
            width: 24px;
            height: 24px;
            color: var(--c-accent);
            transition: transform 0.2s;
        }

        #start-menu {
            position: absolute;
            bottom: 65px;
            left: 10px;
            width: 250px;
            padding: 10px;
            border-radius: 16px;
            background-color: var(--c-surface);
            border: 1px solid var(--c-border);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            box-shadow: 0 10px 30px var(--c-shadow-glass);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.9) translateY(10px);
            transform-origin: bottom left;
            transition: all 0.3s ease;
        }

        #start-menu.is-open {
            opacity: 1;
            visibility: visible;
            transform: scale(1) translateY(0);
        }

        .menu-item {
            padding: 8px 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            color: var(--c-text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item svg {
            width: 18px;
            height: 18px;
            color: var(--c-text-secondary);
        }

        .dock-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s var(--ease-out-quad);
            position: relative;
        }

        .dock-icon:hover {
            transform: translateY(-5px);
        }

        .dock-icon svg {
            width: 24px;
            height: 24px;
            color: var(--c-text-primary);
            transition: color 0.2s;
        }

        .dock-icon[data-app="settings"] {
            background-color: rgba(109, 138, 174, 0.4);
        }

        .dock-icon[data-app="files"] {
            background-color: rgba(255, 175, 50, 0.4);
        }

        .dock-icon[data-app="terminal"] {
            background-color: rgba(60, 60, 60, 0.4);
        }

        .dock-icon[data-app="browser"] {
            background-color: rgba(120, 220, 232, 0.4);
        }

        .dock-icon.is-active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--c-accent);
            box-shadow: 0 0 5px var(--c-accent-glow);
        }

        #dock-time {
            font-size: 14px;
            font-weight: 500;
            color: var(--c-text-primary);
            padding: 0 8px;
            text-align: center;
            width: 120px;
            line-height: 1.2;
        }

        #dock-time:hover .time-seconds {
            visibility: visible;
        }

        .time-seconds {
            font-size: 0.8em;
            color: var(--c-text-secondary);
            visibility: hidden;
            margin-left: 5px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .close {
            background-color: #ff5f57;
        }

        .minimize {
            background-color: #febc2e;
        }

        .maximize {
            background-color: #28c840;
        }

        .window-title {
            flex-grow: 1;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--c-text-secondary);
        }

        .window-content {
            flex-grow: 1;
            padding: 0;
            overflow: hidden;
            color: var(--c-text-primary);
            display: flex;
        }

        .settings-content {
            display: flex;
            flex-direction: row;
            width: 100%;
            height: 100%;
        }

        #settings-sidebar {
            width: 250px;
            flex-shrink: 0;
            padding: 10px 8px;
            background-color: var(--c-surface-alt);
            overflow-y: auto;
            border-right: 1px solid var(--c-border);
        }

        .settings-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            margin: 4px 0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--c-text-primary);
            transition: background-color 0.15s, color 0.15s;
        }

        .settings-nav-item:hover {
            background-color: rgba(120, 220, 232, 0.1);
        }

        .settings-nav-item.is-active {
            background-color: var(--c-accent);
            color: #1a1c23;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .settings-nav-item.is-active svg {
            color: #1a1c23 !important;
        }

        .settings-nav-item svg {
            width: 18px;
            height: 18px;
            color: var(--c-text-secondary);
        }

        #settings-main-view {
            flex-grow: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .setting-section {
            display: none;
            flex-direction: column;
            gap: 24px;
        }

        .setting-section.is-active {
            display: flex;
        }

        .setting-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--c-border);
        }

        .setting-list-item:last-child {
            border-bottom: none;
        }

        .setting-list-item label {
            font-size: 14px;
            font-weight: 500;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--c-surface-alt);
            transition: .4s;
            border-radius: 26px;
            border: 1px solid var(--c-border);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        input:checked+.slider {
            background-color: var(--c-accent);
            border-color: var(--c-accent);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .wallpaper-item {
            width: 100%;
            padding-top: 56.25%;
            height: 0;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s, transform 0.2s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .wallpaper-item:hover {
            transform: scale(1.03);
        }

        .wallpaper-item.is-selected {
            border-color: var(--c-accent);
            box-shadow: 0 0 10px var(--c-accent-glow);
        }

        #upload-wallpaper-btn {
            padding: 8px 16px;
            border: 1px solid var(--c-border);
            border-radius: 8px;
            background-color: var(--c-surface-alt);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            color: var(--c-text-primary);
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        #upload-wallpaper-btn:hover {
            background-color: var(--c-surface);
            box-shadow: 0 0 5px var(--c-accent-glow);
        }

        .welcome-content {
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }

        .welcome-content h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 0.2em;
        }

        .welcome-content p {
            font-size: 1.1em;
            color: var(--c-text-secondary);
        }

        #footer-credit {
            position: fixed;
            bottom: 12px;
            left: 12px;
            z-index: 10001;
        }

        #footer-credit a {
            text-decoration: none;
            color: var(--c-text-secondary);
            font-size: 12px;
            opacity: 0.4;
            transition: opacity 0.3s ease;
        }

        #footer-credit a:hover {
            opacity: 1;
        }

        .snap-indicator {
            position: fixed;
            z-index: 10000;
            top: 0;
            width: 50vw;
            height: 100vh;
            background: var(--c-accent-glow);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease-out;
            border: 2px dashed var(--c-accent);
        }

        #snap-left {
            left: 0;
        }

        #snap-right {
            right: 0;
        }

        .snap-indicator.is-visible {
            opacity: 0.2;
        }

        /* --- [INJECTION 1] - NEURA ORB (VOICE) STYLES --- */
        #neura-orb-container {
            position: fixed;
            bottom: 120px;
            /* Positioned above the dock */
            left: 50%;
            transform: translateX(-50%) scale(0);
            /* Hidden by default */
            display: flex;
            gap: 10px;
            z-index: 100000;
            transition: transform 0.4s var(--ease-out-back);
            pointer-events: none;
        }

        #neura-orb-container.is-listening {
            transform: translateX(-50%) scale(1);
            /* Show when listening */
        }

        .orb-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: var(--c-accent);
            box-shadow: 0 0 15px var(--c-accent-glow);
            animation: pulse 1.5s infinite ease-in-out;
        }

        .orb-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .orb-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(0.8);
                opacity: 0.7;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        /* --- END ORB STYLES --- */
        /* --- [NEW] REAL BROWSER STYLES --- */
        .browser-toolbar {
            flex-grow: 1;
            display: flex;
            align-items: center;
            padding: 0 8px;
            gap: 8px;
        }

        .browser-nav {
            background: none;
            border: none;
            color: var(--c-text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .browser-nav:hover:not(:disabled) {
            background-color: var(--c-surface-alt);
            color: var(--c-text-primary);
        }

        .browser-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        #browser-url-bar {
            flex-grow: 1;
            height: 28px;
            border-radius: 8px;
            border: 1px solid var(--c-border);
            background-color: var(--c-surface-alt);
            padding: 0 12px;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            color: var(--c-text-primary);
            box-shadow: 0 1px 3px var(--c-shadow-glass) inset;
        }

        #browser-url-bar:focus {
            outline: none;
            border-color: var(--c-accent);
            box-shadow: 0 0 0 2px var(--c-accent-glow);
        }

        webview {
            flex-grow: 1;
            background-color: #fff;
            /* White background while loading */
        }
        /* --- APP STORE DOCK ICON --- */
.dock-icon[data-app="app-store"] { background-color: rgba(84, 160, 255, 0.4); }

/* --- APP STORE STYLES --- */
.app-store-content {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
}
.app-store-content h1 {
    margin-bottom: 5px;
}
.app-store-content p {
    color: var(--c-text-secondary);
    margin-bottom: 24px;
}
.app-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 20px;
}
.app-card {
    background-color: var(--c-surface-alt);
    border: 1px solid var(--c-border);
    border-radius: 12px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
}
.app-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 15px var(--c-shadow-soft);
}
.app-card-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
}
.app-card-icon svg {
    width: 28px;
    height: 28px;
    color: var(--c-text-primary);
}
.app-card-title {
    font-weight: 500;
    color: var(--c-text-primary);
}
.app-card-category {
    font-size: 12px;
    color: var(--c-text-secondary);
}
.app-card-button {
    width: 100%;
    margin-top: 10px;
    padding: 6px;
    font-size: 13px;
    font-weight: 500;
    background-color: var(--c-accent);
    color: #1a1c23;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
}
.app-card-button:hover {
    filter: brightness(1.1);
}
.app-card-button:disabled {
    background-color: var(--c-surface-alt);
    color: var(--c-text-secondary);
    cursor: not-allowed;
}
    </style>
</head>

<body>

    <!-- [INJECTION 2: NEURA ORB HTML] -->
    <div id="neura-orb-container">
        <div class="orb-dot"></div>
        <div class="orb-dot"></div>
        <div class="orb-dot"></div>
    </div>
    <!-- END ORB HTML -->

    <div id="snap-left" class="snap-indicator"></div>
    <div id="snap-right" classs="snap-indicator"></div>

    <div id="desktop">

        <div id="notch">
            <div id="notch-content">
                <div class="notch-controls">
                    <button>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                            <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                            <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                            <line x1="12" y1="20" x2="12.01" y2="20"></line>
                        </svg>
                    </button>
                    <button>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                    </button>
                </div>

                <div id="clock">22:39</div>
                <div class="notch-status">
                    <div class="search-bar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" placeholder="Search...">
                    </div>

                    <label class="theme-switch" style="margin-left: 10px;">
                        <input type="checkbox" id="theme-toggle-notch">
                        <span class="slider"></span>
                    </label>
                    <div id="power-container">
                        <button id="power-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                                <line x1="12" y1="2" x2="12" y2="12"></line>
                            </svg>
                        </button>
                        <div id="power-menu-dropdown">
                            <div class="menu-item" data-action="sleep">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M12 20V4" />
                                    <path d="M6 16.68C6 15.63 8 14 12 14s6 1.63 6 2.68" />
                                    <path d="M12 4s.75 3 4 3 4-3 4-3" />
                                    <path d="M12 4s-.75 3-4 3-4-3-4-3" />
                                </svg>
                                Sleep
                            </div>
                            <div class="menu-item" data-action="restart">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M16 17l-4 4-4-4" />
                                    <path d="M12 21V3" />
                                    <path
                                        d="M7 6H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-3" />
                                </svg>
                                Restart
                            </div>
                            <div class="menu-item" data-action="shutdown">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                                    <line x1="12" y1="2" x2="12" y2="12"></line>
                                </svg>
                                Shutdown
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="desktop-icons">
            <div class="desktop-icon" data-app="settings">
                <div class="icon-glyph">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </div>
                <span class="icon-label">Settings</span>
            </div>
            <div class="desktop-icon" data-app="app-store">
    <div class="icon-glyph">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"></path><path d="M16 10h.01"></path><path d="M18 10h.01"></path><path d="M20 10h.01"></path><path d="m12 18 4-4"></path><path d="M16 14h.01"></path><path d="M18 14h.01"></path><path d="M20 14h.01"></path><path d="m12 6 4-4"></path><path d="M16 2h.01"></path><path d="M18 2h.01"></path><path d="M20 2h.01"></path><path d="m12 10 4-4"></path><path d="M16 6h.01"></path><path d="M18 6h.01"></path><path d="M20 6h.01"></path><path d="M6 14h.01"></path><path d="M4 14h.01"></path><path d="M2 14h.01"></path><path d="M6 18h.01"></path><path d="M4 18h.01"></path><path d="M2 18h.01"></path><path d="M6 10h.01"></path><path d="M4 10h.01"></path><path d="M2 10h.01"></path><path d="M6 6h.01"></path><path d="M4 6h.01"></path><path d="M2 6h.01"></path></svg>
    </div>
    <span class="icon-label">App Store</span>
</div>
            <div class="desktop-icon" data-app="files">
                <div class="icon-glyph">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <span class="icon-label">Files</span>
            </div>
            <div class="desktop-icon" data-app="terminal">
                <div class="icon-glyph">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="4 17 10 11 4 5"></polyline>
                        <line x1="12" y1="19" x2="20" y2="19"></line>
                    </svg>
                </div>
                <span class="icon-label">Terminal</span>
            </div>
            <div class="desktop-icon" data-app="browser">
                <div class="icon-glyph">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path
                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                        </path>
                    </svg>
                </div>
                <span class="icon-label">Browser</span>
            </div>
        </div>

        <div id="windows-container">
            <div class="window is-closing" id="settings-window" data-app-window="settings"
                style="left: 423px; top: 161px; z-index: 124;">
                <div class="window-header">
                    <div class="window-controls">
                        <div class="window-control close" data-control="close"></div>
                        <div class="window-control minimize" data-control="minimize"></div>
                        <div class="window-control maximize" data-control="maximize"></div>
                    </div>
                    <div class="window-title">Settings</div>
                </div>
                <div class="window-content settings-content">

                    <div id="settings-sidebar">
                        <div class="settings-nav-item" data-section="general" data-default="true">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg>
                            General
                        </div>
                        <div class="settings-nav-item" data-section="appearance">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M12 21.5a9.5 9.5 0 1 0 0-19 9.5 9.5 0 0 0 0 19zM12 17V7"></path>
                                <path d="M12 21.5a9.5 9.5 0 0 0 7.5-3.5L12 7" />
                            </svg>
                            Appearance
                        </div>
                        <div class="settings-nav-item" data-section="wallpaper">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M15 17h5a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h2">
                                </path>
                                <path d="M10 20h4a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2z">
                                </path>
                                <path d="M18 10a.5.5 0 1 0 .01 0"></path>
                                <path d="M6 10a.5.5 0 1 0 .01 0"></path>
                            </svg>
                            Wallpaper
                        </div>
                        <div class="settings-nav-item" data-section="version">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            About OS
                        </div>
                    </div>

                    <div id="settings-main-view">

                        <div class="setting-section is-active" data-section-content="general">
                            <h1>General Settings</h1>
                            <p class="text-secondary">Basic configuration options for Neura OS.</p>
                            <div class="setting-list-item">
                                <label>Language</label>
                                <span>English (US)</span>
                            </div>
                            <div class="setting-list-item">
                                <label>Date & Time</label>
                                <span>Auto Sync (Local Time)</span>
                            </div>
                            <div class="setting-list-item">
                                <label>Keyboard Layout</label>
                                <span>QWERTY</span>
                            </div>
                        </div>

                        <div class="setting-section" data-section-content="appearance">
                            <h1>Appearance</h1>
                            <p class="text-secondary">Customize the look and feel of your desktop.</p>
                            <div class="setting-list-item">
                                <label for="theme-toggle">Dark Mode</label>
                                <label class="theme-switch">
                                    <input type="checkbox" id="theme-toggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-list-item">
                                <label>Window Transparency</label>
                                <span>Glassmorphism (High)</span>
                            </div>
                            <div class="setting-list-item">
                                <label>Font Family</label>
                                <span>Inter (Default)</span>
                            </div>
                        </div>

                        <div class="setting-section" data-section-content="wallpaper">
                            <h1>Wallpaper</h1>
                            <p class="text-secondary">Select a preset or upload your own background image.</p>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <label class="text-sm font-semibold">Wallpaper Presets</label>
                                <div class="wallpaper-grid" id="wallpaper-grid">
                                    <div class="wallpaper-item" data-wallpaper="1" data-type="image"
                                        style="background-image: url('https://source.unsplash.com/1600x900/?dark-abstract');"
                                        onerror="this.style.backgroundImage = this.style.backgroundImage;"></div>
                                    <div class="wallpaper-item" data-wallpaper="2" data-type="image"
                                        style="background-image: url('https://source.unsplash.com/1600x900/?mountain,space');"
                                        onerror="this.style.backgroundImage = this.style.backgroundImage;"></div>
                                    <div class="wallpaper-item" data-wallpaper="3" data-type="image"
                                        style="background-image: url('https://source.unsplash.com/1600x900/?cityscape,night');"
                                        onerror="this.style.backgroundImage = this.style.backgroundImage;"></div>
                                    <div class="wallpaper-item" data-wallpaper="4" data-type="image"
                                        style="background-image: url('https://source.unsplash.com/1600x900/?minimal,pastel');"
                                        onerror="this.style.backgroundImage = this.style.backgroundImage;"></div>

                                    <div class="wallpaper-item" data-wallpaper="5" data-type="color"
                                        data-color-hex="#334155"
                                        style="background-color: #334155; border: 1px solid var(--c-border); background-image: none;">
                                    </div>

                                </div>
                            </div>

                            <hr
                                style="border: none; border-top: 1px solid var(--c-border); width: 100%; margin: 10px 0;">

                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <label class="text-sm font-semibold">Custom Upload</label>
                                <input type="file" id="wallpaper-file-input" accept="image/*" style="display: none;">
                                <button id="upload-wallpaper-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M4 14.899V20a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5.101M16 10l-4-4-4 4M12 16V6" />
                                    </svg>
                                    Upload Custom Image
                                </button>
                            </div>
                        </div>

                        <div class="setting-section" data-section-content="version">
                            <h1>About Neura OS</h1>
                            <p class="text-secondary">System information and version details.</p>
                            <div class="setting-list-item">
                                <span>Version</span>
                                <span>Neura OS 1.2 (Marble Horizon Enhanced)</span>
                            </div>
                            <div class="setting-list-item">
                                <span>Build Date</span>
                                <span>2024-03-20</span>
                            </div>
                            <div class="setting-list-item">
                                <span>Processor</span>
                                <span>Simulated Core i9 (4.5 GHz)</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="window is-closing" id="files-window" data-app-window="files"
                style="left: 423px; top: 160.5px; z-index: 128;">
                <div class="window-header">
                    <div class="window-controls">
                        <div class="window-control close" data-control="close"></div>
                        <div class="window-control minimize" data-control="minimize"></div>
                        <div class="window-control maximize" data-control="maximize"></div>
                    </div>
                    <div class="window-title">Files</div>
                </div>
                <div class="files-toolbar">
                    <button id="files-back-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                    </button>
                    <button id="files-forward-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12h14"></path>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                    <div id="files-breadcrumb">/</div>
                    <button id="files-new-folder-btn" title="New Folder" style="margin-left: auto;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 4h1a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
                            <path d="M13 4h6a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
                            <path d="M5 14h1a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2z"></path>
                            <path d="M13 14h6a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2z"></path>
                        </svg>
                    </button>
                    <button id="files-delete-btn" title="Move to Bin">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                </div>
                <div class="files-list" id="files-list-content">
                </div>
            </div>

            <div class="window is-closing" id="terminal-window" data-app-window="terminal"
                style="left: 463px; top: 200.5px; z-index: 114;">
                <div class="window-header">
                    <div class="window-controls">
                        <div class="window-control close" data-control="close"></div>
                        <div class="window-control minimize" data-control="minimize"></div>
                        <div class="window-control maximize" data-control="maximize"></div>
                    </div>
                    <div class="window-title">Terminal</div>
                </div>
                <div class="terminal-content">
                    <div class="terminal-output" id="terminal-output">
                        <div class="terminal-line"><span class="terminal-prompt">neuraOS&nbsp;$</span> Welcome to Neura
                            Terminal (v1.1)</div>
                        <div class="terminal-line"><span class="terminal-prompt">neuraOS&nbsp;$</span> Type 'help' for
                            available commands.</div>
                    </div>
                    <div class="terminal-input-line">
                        <span class="terminal-prompt" id="terminal-prompt-prefix">neuraOS&nbsp;$</span>
                        <input type="text" id="terminal-input" data-terminal-path="/home/user/">
                    </div>
                </div>
            </div>

            <div class="window" id="browser-window" data-app-window="browser">
                <div class="window-header">
                    <div class="window-controls">
                        <div class="window-control close" data-control="close"></div>
                        <div class="window-control minimize" data-control="minimize"></div>
                        <div class="window-control maximize" data-control="maximize"></div>
                    </div>

                    <div class="browser-toolbar">
                        <button class="browser-nav" id="browser-back" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M19 12H5"></path>
                                <polyline points="12 19 5 12 12 5"></polyline>
                            </svg>
                        </button>
                        <button class="browser-nav" id="browser-forward" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M5 12h14"></path>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                        </button>
                        <input type="text" id="browser-url-bar" placeholder="https://google.com">
                    </div>
                </div>

                <webview id="browser-view" src="https://www.google.com/search?q=Neura+OS"
                    style="height: 100%; width: 100%; border: none;"></webview>

            </div>
            
                <div class="window" id="app-store-window" data-app-window="app-store">
    <div class="window-header">
        <div class="window-controls">
            <div class="window-control close" data-control="close"></div>
            <div class="window-control minimize" data-control="minimize"></div>
            <div class="window-control maximize" data-control="maximize"></div>
        </div>
        <div class="window-title">App Store</div>
    </div>
    <div class="window-content app-store-content">
        <h1>Neura App Store</h1>
        <p>Discover apps for your system.</p>
        <div class="app-grid">
            </div>
    </div>
</div>
        </div>

        <div id="start-menu">
            <div class="menu-item" data-app="settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
                Settings
            </div>
            <div class="menu-item" data-app="app-store">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"></path><path d="M16 10h.01"></path><path d="M18 10h.01"></path><path d="M20 10h.01"></path><path d="m12 18 4-4"></path><path d="M16 14h.01"></path><path d="M18 14h.01"></path><path d="M20 14h.01"></path><path d="m12 6 4-4"></path><path d="M16 2h.01"></path><path d="M18 2h.01"></path><path d="M20 2h.01"></path><path d="m12 10 4-4"></path><path d="M16 6h.01"></path><path d="M18 6h.01"></path><path d="M20 6h.01"></path><path d="M6 14h.01"></path><path d="M4 14h.01"></path><path d="M2 14h.01"></path><path d="M6 18h.01"></path><path d="M4 18h.01"></path><path d="M2 18h.01"></path><path d="M6 10h.01"></path><path d="M4 10h.01"></path><path d="M2 10h.01"></path><path d="M6 6h.01"></path><path d="M4 6h.01"></path><path d="M2 6h.01"></path></svg>
    App Store
</div>
            <div class="menu-item" data-app="files">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
                Files
            </div>
            <div class="menu-item" data-app="terminal">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
                Terminal
            </div>
            <div class="menu-item" data-app="browser">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="2" y1="12" x2="22" y2="12"></line>
                    <path
                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                    </path>
                </svg>
                Browser
            </div>
            <hr style="border: none; border-top: 1px solid var(--c-border); margin: 8px 0;">
            <div class="menu-item" data-action="shutdown">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                    <line x1="12" y1="2" x2="12" y2="12"></line>
                </svg>
                Shutdown
            </div>
        </div>
    </div>

    <div id="dock">
        <div id="start-menu-btn" data-action="toggle-menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="12" y1="2" x2="12" y2="22"></line>
                <line x1="2" y1="12" x2="22" y2="12"></line>
            </svg>
        </div>

        <div class="dock-separator"></div>

        <div class="dock-icon" data-app="settings">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                </path>
            </svg>
        </div>
        <div class="dock-icon" data-app="app-store">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"></path><path d="M16 10h.01"></path><path d="M18 10h.01"></path><path d="M20 10h.01"></path><path d="m12 18 4-4"></path><path d="M16 14h.01"></path><path d="M18 14h.01"></path><path d="M20 14h.01"></path><path d="m12 6 4-4"></path><path d="M16 2h.01"></path><path d="M18 2h.01"></path><path d="M20 2h.01"></path><path d="m12 10 4-4"></path><path d="M16 6h.01"></path><path d="M18 6h.01"></path><path d="M20 6h.01"></path><path d="M6 14h.01"></path><path d="M4 14h.01"></path><path d="M2 14h.01"></path><path d="M6 18h.01"></path><path d="M4 18h.01"></path><path d="M2 18h.01"></path><path d="M6 10h.01"></path><path d="M4 10h.01"></path><path d="M2 10h.01"></path><path d="M6 6h.01"></path><path d="M4 6h.01"></path><path d="M2 6h.01"></path></svg>
</div>
        <div class="dock-icon" data-app="files">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
        </div>
        <div class="dock-icon" data-app="terminal">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="4 17 10 11 4 5"></polyline>
                <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
        </div>
        <div class="dock-icon" data-app="browser">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                </path>
            </svg>
        </div>

        <div class="dock-separator"></div>

        <div id="dock-time">10:54 PM</div>

    </div>

    <!--<div id="footer-credit">
        <a href="https://www.sitee.in" target="_blank">Made with love by sitee</a>
    </div>-->

    <!-- 
    =====================================================================
    [INJECTION 3 & 4: COMBINED AND CORRECTED SCRIPT BLOCK]
    This single script block contains ALL JavaScript.
    The new voice logic is at the top, and your original UI logic is
    at the bottom, all safely inside the DOMContentLoaded listener.
    This fixes the bug where the orb would disappear instantly.
    =====================================================================
    --><script>
    document.addEventListener('DOMContentLoaded', () => {
// --- [NEW] NEURA VOICE LOGIC ---
            const orb = document.getElementById('neura-orb-container');

            // This function is called by the `onStartListening` event from main.js
            window.activateNeura = function() {
                if (!orb) return;
                
                // 1. Show the orb to indicate listening
                orb.classList.add('is-listening');
                console.log("Activating Neura... sending signal to Python.");

                // 2. Send the "activate" signal to the Python server
                fetch('http://localhost:5001/api/activate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({}) // Send an empty body
                })
                .then(response => response.json())
                .then(data => {
                    // 4. Python has finished. Hide the orb.
                    console.log("Python cycle finished:", data);
                    if (orb) orb.classList.remove('is-listening');
                })
                .catch(error => {
                    // 5. Handle errors
                    console.error('Fetch Error:', error);
                    osMessage("Neura Error", "Sorry, I can't connect to my brain. Is the Python server running?");
                    if (orb) orb.classList.remove('is-listening');
                });
            }

            // This is the listener that receives the `Cmd+N` signal from main.js
            if (window.electronAPI) {
                window.electronAPI.onStartListening(() => {
                    console.log("Wake-word shortcut detected!");
                    // Call our new activation function
                    if (window.activateNeura) window.activateNeura();
                });
            }
            // --- END OF NEW VOICE LOGIC ---

        function speakResponse(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 1.0;
            const setVoice = () => {
                const voices = speechSynthesis.getVoices();
                utterance.voice = voices.find(v => v.name.includes("Siri") || v.name.includes("Google")) || voices[0];
            };
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.onvoiceschanged = setVoice;
            } else { setVoice(); }
            speechSynthesis.speak(utterance);
        }
        
        function sendNeuraCommand(prompt) {
            console.log("Sending to Neura Brain:", prompt);
            fetch('http://localhost:5001/api/prompt', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response_text) {
                    console.log("Neura Brain Response:", data.response_text);
                    speakResponse(data.response_text);
                    if (openWindows['terminal']) {
                        writeTerminal(data.response_text);
                    }
                } else if (data.error) {
                    speakResponse("I encountered an error.");
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                speakResponse("Sorry, I can't connect to my brain.");
            });
        }

        if (window.electronAPI) {
            window.electronAPI.onStartListening(() => {
                console.log("Wake-word shortcut detected!");
                if (window.startListening) window.startListening();
            });
        }
        // --- END VOICE LOGIC ---


        // --- OS Message Function ---
        window.osMessage = (title, message) => {
            console.warn(`[osMessage]: ${title} - ${message}`);
            alert(`${title}\n\n${message}`);
        };


        // --- CORE UI & WINDOWING LOGIC ---
        const windowOffsets = {};
        const windowState = {};
        const desktopIcons = document.querySelectorAll('.desktop-icon');
        const dockIcons = document.querySelectorAll('.dock-icon');
        const startMenu = document.getElementById('start-menu');
        const startMenuBtn = document.getElementById('start-menu-btn');
        const menuItems = document.querySelectorAll('#start-menu .menu-item');
        const windowHeaders = document.querySelectorAll('.window-header');
        const body = document.body; 
        const powerButton = document.getElementById('power-button');
        const powerMenu = document.getElementById('power-menu-dropdown');
        const powerMenuItems = powerMenu ? powerMenu.querySelectorAll('.menu-item') : [];
        const snapLeft = document.getElementById('snap-left');
        const snapRight = document.getElementById('snap-right');
        const windowsContainer = document.getElementById('windows-container');
        // ... (inside your existing <script> tag)

        // ==========================================
        // === PASTE THE MISSING CODE HERE ===
        // ==========================================
        const settingsNavItems = document.querySelectorAll('#settings-sidebar .settings-nav-item');
        const settingSections = document.querySelectorAll('#settings-main-view .setting-section');

        settingsNavItems.forEach(item => {
            item.addEventListener('click', () => {
                const sectionName = item.getAttribute('data-section');
                showSettingsSection(sectionName);
            });
        });
        // ==========================================
        // ==========================================
Â  Â  Â  Â Â 

// ... (rest of your script)
        let activeWindow = null;
        let highestZIndex = 100;
        const openWindows = {};

        function setDockActiveState() {
            dockIcons.forEach(icon => {
                const appName = icon.getAttribute('data-app');
                icon.classList.remove('is-active');
                if (openWindows[appName] && openWindows[appName].classList.contains('is-open')) {
                    icon.classList.add('is-active');
                }
            });
        }
        function focusWindow(windowEl) {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('is-focused'));
            highestZIndex++;
            windowEl.style.zIndex = highestZIndex;
            windowEl.classList.add('is-focused');
            if (windowEl.getAttribute('data-app-window') === 'terminal') {
                document.getElementById('terminal-input')?.focus();
            }
        }
        function saveWindowState(windowEl) {
            const appName = windowEl.getAttribute('data-app-window');
            windowState[appName] = {
                width: windowEl.offsetWidth + 'px', height: windowEl.offsetHeight + 'px',
                transform: windowEl.style.transform, left: windowEl.style.left, top: windowEl.style.top,
                wasMaximized: windowEl.classList.contains('is-maximized'),
                wasSnapped: windowEl.classList.contains('is-snapped-left') || windowEl.classList.contains('is-snapped-right'),
                windowOffsets: windowOffsets[windowEl.id] || {x: 0, y: 0}
            };
        }
        function openApp(appName) {
            let windowEl = document.querySelector(`[data-app-window="${appName}"]`);
            if (!windowEl) return;
            if (windowEl.classList.contains('is-minimized')) {
                restoreWindow(windowEl); focusWindow(windowEl); return;
            }
            if (windowEl.classList.contains('is-open')) {
                focusWindow(windowEl); return;
            }
            const openCount = Object.keys(openWindows).length, offset = openCount * 20;
            const windowWidth = 800 * 0.7, windowHeight = 600 * 0.6;
            const initialX = `calc(50% - ${windowWidth / 2}px)`, initialY = `calc(50% - ${windowHeight / 2}px)`;
            windowEl.style.left = initialX; windowEl.style.top = initialY;
            windowOffsets[windowEl.id] = { x: offset, y: offset };
            windowEl.style.transform = `translate(${offset}px, ${offset}px) scale(1)`;
            windowEl.style.width = windowWidth + 'px'; windowEl.style.height = windowHeight + 'px';
            windowEl.classList.remove('is-closing'); windowEl.classList.add('is-open');
            windowEl.classList.remove('is-maximized', 'is-snapped-left', 'is-snapped-right');
            windowEl.style.resize = 'both';
            focusWindow(windowEl);
            openWindows[appName] = windowEl;
            setDockActiveState(); closeMenu(); closePowerMenu();
            
            // --- Init functions for REAL apps ---
            if (appName === 'terminal') { initTerminal(); } 
            else if (appName === 'files') { initFileExplorer(); }
            else if (appName === 'settings') { initWallpaperSettings(); showSettingsSection('general'); }
            else if (appName === 'app-store') { loadAppStore(); } // [FIX] Load app store every time
            else if (appName === 'browser') { initBrowser(); }
        }
        function closeApp(appName) {
            const windowEl = openWindows[appName];
            if (windowEl) {
                windowEl.classList.add('is-closing');
                windowEl.classList.remove('is-open', 'is-focused', 'is-maximized', 'is-minimized', 'is-snapped-left', 'is-snapped-right');
                delete openWindows[appName];
                setTimeout(() => windowEl.classList.remove('is-closing'), 400); 
                setDockActiveState();
            }
        }
        function minimizeWindow(windowEl) { saveWindowState(windowEl); windowEl.classList.remove('is-open', 'is-focused'); windowEl.classList.add('is-minimized'); setDockActiveState(); }
        function restoreWindow(windowEl) {
            const appName = windowEl.getAttribute('data-app-window'), savedState = windowState[appName];
            windowEl.classList.remove('is-minimized'); windowEl.classList.add('is-open');
            if (savedState) {
                windowEl.classList.remove('is-maximized', 'is-snapped-left', 'is-snapped-right');
                Object.assign(windowEl.style, { resize: 'both', borderRadius: '16px', width: savedState.width, height: savedState.height, left: savedState.left, top: savedState.top, transform: savedState.transform });
                windowOffsets[windowEl.id] = savedState.windowOffsets;
                if (savedState.wasMaximized) maximizeWindow(windowEl, true); 
            } else { openApp(appName); }
            focusWindow(windowEl);
        }
        function maximizeWindow(windowEl, isRestoring = false) {
            const isCurrentlyMaximized = windowEl.classList.contains('is-maximized');
            if (isCurrentlyMaximized && !isRestoring) { restoreFromSpecialState(windowEl); }
            else if (!isCurrentlyMaximized && !isRestoring) {
                saveWindowState(windowEl);
                windowEl.classList.remove('is-snapped-left', 'is-snapped-right');
                windowEl.classList.add('is-maximized');
                Object.assign(windowEl.style, { width: '', height: '', transform: '', left: '', top: '', resize: 'none', borderRadius: '' });
            }
            focusWindow(windowEl);
        }
        function restoreFromSpecialState(windowEl) {
            const appName = windowEl.getAttribute('data-app-window'), savedState = windowState[appName];
            windowEl.classList.remove('is-maximized', 'is-snapped-left', 'is-snapped-right');
            if (savedState) {
                Object.assign(windowEl.style, { width: savedState.width, height: savedState.height, left: savedState.left, top: savedState.top, transform: savedState.transform, borderRadius: '16px', resize: 'both' });
                windowOffsets[windowEl.id] = savedState.windowOffsets;
            }
        }
        function showSettingsSection(sectionName) {
            settingsNavItems.forEach(item => item.classList.toggle('is-active', item.getAttribute('data-section') === sectionName));
            settingSections.forEach(section => section.classList.toggle('is-active', section.getAttribute('data-section-content') === sectionName));
        }
        function toggleMenu() { startMenu.classList.toggle('is-open'); startMenuBtn.classList.toggle('is-active'); closePowerMenu(); }
        function closeMenu() { if (startMenu) startMenu.classList.remove('is-open'); if (startMenuBtn) startMenuBtn.classList.remove('is-active'); }
        function togglePowerMenu() { if (powerMenu) powerMenu.classList.toggle('is-open'); closeMenu(); }
        function closePowerMenu() { if (powerMenu) powerMenu.classList.remove('is-open'); }
        if (powerButton) powerButton.addEventListener('click', togglePowerMenu);
        powerMenuItems.forEach(item => item.addEventListener('click', () => {
            osMessage('System Action', `Action: ${item.getAttribute('data-action')}`); closePowerMenu();
        }));
        if (startMenuBtn) startMenuBtn.addEventListener('click', toggleMenu);
        menuItems.forEach(item => item.addEventListener('click', () => {
            const appName = item.getAttribute('data-app');
            if (appName) openApp(appName);
            else if (item.getAttribute('data-action') === 'shutdown') { osMessage('System Action', 'Shutting down...'); closeMenu(); }
        }));
        desktopIcons.forEach(icon => icon.addEventListener('click', () => openApp(icon.getAttribute('data-app'))));
        dockIcons.forEach(icon => icon.addEventListener('click', () => openApp(icon.getAttribute('data-app'))));
        if (windowsContainer) windowsContainer.addEventListener('click', (e) => {
            const windowEl = e.target.closest('.window'); if(windowEl) focusWindow(windowEl);
            const control = e.target.getAttribute('data-control'), appWindowEl = e.target.closest('.window'); if (!appWindowEl) return;
            const appName = appWindowEl.getAttribute('data-app-window');
            if (control === 'close') closeApp(appName);
            else if (control === 'minimize') minimizeWindow(appWindowEl);
            else if (control === 'maximize') maximizeWindow(appWindowEl);
        });
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#start-menu-btn') && !e.target.closest('#start-menu')) closeMenu();
            if (!e.target.closest('#power-button') && !e.target.closest('#power-menu-dropdown')) closePowerMenu();
        });
        windowHeaders.forEach(header => {
            header.addEventListener('mousedown', (e) => {
                const windowEl = header.parentElement; if (e.target.closest('.window-control') || windowEl.classList.contains('is-maximized')) return;
                e.preventDefault(); body.style.userSelect = 'none';
                activeWindow = windowEl; focusWindow(activeWindow); activeWindow.classList.add('is-dragging');
                if (windowEl.classList.contains('is-snapped-left') || windowEl.classList.contains('is-snapped-right')) { restoreFromSpecialState(windowEl); }
                saveWindowState(windowEl);
                const windowId = activeWindow.id, initialMouseX = e.clientX, initialMouseY = e.clientY;
                const startX = windowOffsets[windowId]?.x || 0, startY = windowOffsets[windowId]?.y || 0;
                const windowRect = windowEl.getBoundingClientRect(), headerHeight = header.offsetHeight;
                const VP_W = window.innerWidth, VP_H = window.innerHeight, DOCK_H = 80, SNAP_THRESHOLD = 20, HANDLE_MARGIN = 100;
                function onMouseMove(e) {
                    if (!activeWindow) return;
                    let targetScreenX = windowRect.left + (e.clientX - initialMouseX), targetScreenY = windowRect.top + (e.clientY - initialMouseY);
                    const minY = -(windowRect.height - headerHeight), maxY = VP_H - DOCK_H - headerHeight;
                    const minX = -(windowRect.width - HANDLE_MARGIN), maxX = VP_W - HANDLE_MARGIN; 
                    targetScreenX = Math.max(minX, Math.min(maxX, targetScreenX)); targetScreenY = Math.max(minY, Math.min(maxY, targetScreenY));
                    let newX = startX + (targetScreenX - windowRect.left), newY = startY + (targetScreenY - windowRect.top);
                    const isNearLeft = e.clientX < SNAP_THRESHOLD, isNearRight = e.clientX > VP_W - SNAP_THRESHOLD;
                    if (snapLeft) snapLeft.classList.toggle('is-visible', isNearLeft);
                    if (snapRight) snapRight.classList.toggle('is-visible', isNearRight);
                    activeWindow.style.transform = `translate(${newX}px, ${newY}px) scale(1)`;
                    windowOffsets[windowId] = { x: newX, y: newY };
                }
                function onMouseUp(e) {
                    if (!activeWindow) return;
                    const finalX = e.clientX, isNearLeft = finalX < SNAP_THRESHOLD, isNearRight = finalX > VP_W - SNAP_THRESHOLD;
                    if (isNearLeft || isNearRight) {
                        windowEl.classList.toggle('is-snapped-left', isNearLeft);
                        windowEl.classList.toggle('is-snapped-right', isNearRight);
                        windowEl.classList.remove('is-maximized');
                        Object.assign(windowEl.style, { resize: 'none', borderRadius: '0' });
                    }
                    if(snapLeft) snapLeft.classList.remove('is-visible'); if(snapRight) snapRight.classList.remove('is-visible');
                    activeWindow.classList.remove('is-dragging'); body.style.userSelect = ''; activeWindow = null;
                    document.removeEventListener('mousemove', onMouseMove); document.removeEventListener('mouseup', onMouseUp);
                }
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        });
        // --- END OF CORE UI ---


        // --- Clock Logic ---
        const dockTimeElement = document.getElementById('dock-time');
        const notchClockElement = document.getElementById('clock');
        const dateOptions = { month: 'short', day: 'numeric', year: 'numeric' };
        function updateClock() {
            const now = new Date();
            const hours12 = String(now.getHours() % 12 || 12), hours24 = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0'), seconds = String(now.getSeconds()).padStart(2, '0');
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM', date = now.toLocaleDateString('en-US', dateOptions);
            if (dockTimeElement) dockTimeElement.innerHTML = `<span class="time-main">${hours12}:${minutes} ${ampm}</span><span class="time-seconds">${seconds}</span><br>${date}`;
            if (notchClockElement) notchClockElement.textContent = `${hours24}:${minutes}`;
        }
        setInterval(updateClock, 1000); updateClock();


        // --- Theme & Wallpaper Logic ---
        let wallpaperItems = null;
        const wallpaperGrid = document.getElementById('wallpaper-grid');
        const themeToggleSettings = document.getElementById('theme-toggle');
        const themeToggleNotch = document.getElementById('theme-toggle-notch');
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme); localStorage.setItem('theme', theme);
            const isDark = theme === 'dark';
            if (themeToggleSettings) themeToggleSettings.checked = isDark; if (themeToggleNotch) themeToggleNotch.checked = isDark;
        }
        applyTheme(localStorage.getItem('theme') || 'dark');
        [themeToggleSettings, themeToggleNotch].forEach(toggle => {
            if (toggle) toggle.addEventListener('change', function() { applyTheme(this.checked ? 'dark' : 'light'); });
        });
        function createCustomWallpaperItem(imageUrl, wallpaperId) {
            const item = document.createElement('div'); item.className = 'wallpaper-item wallpaper-item-custom';
            item.setAttribute('data-wallpaper', wallpaperId); item.setAttribute('data-type', 'image');
            item.title = "Custom Wallpaper"; if (wallpaperGrid) wallpaperGrid.appendChild(item);
            item.style.backgroundImage = `url('${imageUrl}')`;
        }
        function applyImageWallpaper(imageUrl, wallpaperId) {
            body.style.backgroundImage = `url('${imageUrl}')`; body.style.backgroundColor = '';
            body.setAttribute('data-wallpaper', wallpaperId.startsWith('custom-') ? 'custom' : wallpaperId); 
            localStorage.setItem('wallpaper', wallpaperId);
        }
        function applyColorWallpaper(hexColor, wallpaperId) {
            body.style.backgroundImage = 'none'; body.style.backgroundColor = hexColor;
            body.setAttribute('data-wallpaper', wallpaperId); localStorage.setItem('wallpaper', wallpaperId);
        }
        function updateWallpaperItems() {
            wallpaperItems = document.querySelectorAll('.wallpaper-item');
        }
        function bindWallpaperListeners() {
            updateWallpaperItems();
            if(wallpaperItems) wallpaperItems.forEach(item => {
                item.removeEventListener('click', handleWallpaperClick); item.addEventListener('click', handleWallpaperClick);
            });
        }
        function handleWallpaperClick() {
            const item = this, wallpaperId = item.getAttribute('data-wallpaper'), type = item.getAttribute('data-type');
            updateWallpaperItems(); wallpaperItems.forEach(w => w.classList.remove('is-selected'));
            item.classList.add('is-selected');
            if (type === 'image') { applyImageWallpaper(item.style.backgroundImage.slice(5, -2), wallpaperId); }
            else if (type === 'color') { applyColorWallpaper(item.getAttribute('data-color-hex'), wallpaperId); }
        }
        function initWallpaperSettings() {
            if(!wallpaperGrid) return;
            (JSON.parse(localStorage.getItem('customWallpapers')) || []).forEach(wp => createCustomWallpaperItem(wp.url, wp.id)); 
            bindWallpaperListeners(); 
            const savedWallpaperId = localStorage.getItem('wallpaper') || '1';
            const savedItem = document.querySelector(`.wallpaper-item[data-wallpaper="${savedWallpaperId}"]`);
            if (savedItem) { savedItem.click(); }
            else { document.querySelector('.wallpaper-item[data-wallpaper="1"]')?.click(); }
        }
        const wallpaperFileInput = document.getElementById('wallpaper-file-input');
        const uploadWallpaperBtn = document.getElementById('upload-wallpaper-btn');
        if (uploadWallpaperBtn) uploadWallpaperBtn.addEventListener('click', () => wallpaperFileInput.click());
        if (wallpaperFileInput) wallpaperFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result, newId = 'custom-' + Date.now();
                    const newWallpaper = { id: newId, url: imageUrl };
                    const customWallpapers = JSON.parse(localStorage.getItem('customWallpapers')) || [];
                    customWallpapers.push(newWallpaper);
                    localStorage.setItem('customWallpapers', JSON.stringify(customWallpapers));
                    createCustomWallpaperItem(imageUrl, newId);
                    bindWallpaperListeners();
                    document.querySelector(`.wallpaper-item[data-wallpaper="${newId}"]`)?.click();
                    osMessage('Settings', 'Custom wallpaper uploaded and applied.');
                };
                reader.readAsDataURL(file);
            } else if (file) { osMessage('Settings Error', 'Please select a valid image file.'); }
        });


        // --- [REAL] SYSTEM MONITOR (connects to main.js) ---
        const cpuBar = document.getElementById('cpu-bar'), cpuValue = document.getElementById('cpu-value');
        const ramBar = document.getElementById('ram-bar'), ramValue = document.getElementById('ram-value');
        const canvas = document.getElementById('cpu-chart');
        let cpuHistory = new Array(60).fill(0); 
        function drawChart() {
            if (!canvas || !canvas.getContext) return; const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect(), dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr; canvas.height = rect.height * dpr; ctx.scale(dpr, dpr);
            const width = rect.width, height = rect.height; ctx.clearRect(0, 0, width, height);
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--c-accent').trim();
            ctx.strokeStyle = accentColor; ctx.lineWidth = 2; ctx.beginPath();
            const sliceWidth = width / (cpuHistory.length - 1);
            for (let i = 0; i < cpuHistory.length; i++) {
                const x = i * sliceWidth, y = height - (cpuHistory[i] * height / 100); 
                if (i === 0) { ctx.moveTo(x, y); } else { ctx.lineTo(x, y); }
            }
            ctx.stroke();
        }
        async function updateSystemStats() {
            const monitorWindow = document.getElementById('system-monitor-window');
            if (!monitorWindow || !monitorWindow.classList.contains('is-open')) return;
            
            if (window.electronAPI?.getSystemStats) {
                const stats = await window.electronAPI.getSystemStats();
                if (ramBar && ramValue) {
                    ramBar.style.width = stats.usedMemPercent.toFixed(0) + '%';
                    ramValue.textContent = `${stats.usedMem} GB / ${stats.totalMem} GB`;
                }
            }
            
            let lastCpu = cpuHistory[cpuHistory.length - 1];
            let newCpu = Math.max(5, Math.min(95, lastCpu + (Math.random() - 0.5) * 10)); 
            cpuHistory.push(newCpu); if (cpuHistory.length > 60) cpuHistory.shift();
            if (cpuBar && cpuValue) { cpuBar.style.width = newCpu.toFixed(0) + '%'; cpuValue.textContent = newCpu.toFixed(0) + '%'; }
            
            drawChart();
        }
        setInterval(updateSystemStats, 1000);
        if (canvas) new ResizeObserver(drawChart).observe(canvas);
        
        
        // --- [REAL] APP STORE LOGIC (connects to main.js) ---
        const appGrid = document.querySelector('.app-grid');
        let appManifest = []; 

        async function loadAppStore() {
            if (!appGrid) return;
            try {
                const response = await fetch('app-manifest.json'); 
                if (!response.ok) throw new Error('app-manifest.json not found');
                appManifest = await response.json();
                
                appGrid.innerHTML = ''; 
                
                // Use Promise.all to check all apps in parallel
                await Promise.all(appManifest.map(async (app) => {
                    const card = document.createElement('div');
                    card.className = 'app-card';
                    
                    // [FIX] Check if the app is installed
                    const isInstalled = await window.electronAPI.checkAppInstalled(app.launch_path_macos);
                    
                    card.innerHTML = `
                        <div class="app-card-icon" style="background-color: #333;">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </div>
                        <div class="app-card-title">${app.name}</div>
                        <div class="app-card-category">${app.category}</div>
                        <button class="app-card-button" data-app-id="${app.id}">
                            ${isInstalled ? 'Launch' : 'Install'}
                        </button>
                    `;
                    card.querySelector('button').addEventListener('click', onAppStoreButtonClick);
                    appGrid.appendChild(card);
                }));

            } catch (err) {
                console.error("Failed to load App Store:", err);
                appGrid.innerHTML = `<p style="color: var(--c-text-secondary);">Could not load app-manifest.json. Make sure the file exists.</p>`;
            }
        }
        
        async function onAppStoreButtonClick(e) {
            const button = e.target;
            const appId = button.getAttribute('data-app-id');
            const app = appManifest.find(a => a.id === appId);
            if (!app) return;

            const action = button.textContent.toLowerCase();

            if (action === 'install') {
                button.textContent = 'Downloading...';
                button.disabled = true;
                const result = await window.electronAPI.installApp(app);
                if (!result.success) {
                    osMessage("Install Error", result.message);
                    button.textContent = 'Install';
                    button.disabled = false;
                }
            } else if (action === 'launch') {
                const result = await window.electronAPI.launchApp(app);
                if (!result.success) {
                    osMessage("Launch Error", result.message); 
                }
            }
        }
        
        if (window.electronAPI) {
            window.electronAPI.onDownloadComplete((data) => {
                if(data.success) {
                    osMessage("Download Complete", `${data.filename} has finished downloading. Please install it, then 'Launch' will work.`);
                    loadAppStore(); // Refresh store to update button state
                }
            });
        }


        // --- [REAL] TERMINAL (connects to AI) ---
        const terminalOutput = document.getElementById('terminal-output');
        const terminalInput = document.getElementById('terminal-input');
        const terminalPromptPrefix = document.getElementById('terminal-prompt-prefix');
        let terminalHistory = [];
        let terminalHistoryIndex = -1;

        function initTerminal() {
            if(terminalInput) terminalInput.focus();
            if(terminalPromptPrefix) terminalPromptPrefix.innerHTML = `neuraOS&nbsp;$`;
        }
        function writeTerminal(text, isCommand = false) {
            if (!terminalOutput) return; const line = document.createElement('div'); line.classList.add('terminal-line');
            if (isCommand) { line.innerHTML = `<span class="terminal-prompt">neuraOS&nbsp;$</span> ${text}`; }
            else { line.textContent = text; } // This is for the AI's response
            terminalOutput.appendChild(line);
            terminalOutput.parentElement.scrollTop = terminalOutput.parentElement.scrollHeight; 
        }
        if (terminalInput) terminalInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); const command = terminalInput.value.trim();
                if (command) { terminalHistory.push(command); terminalHistoryIndex = terminalHistory.length; }
                writeTerminal(command, true);
                
                // --- AI IS THE TERMINAL ---
                sendNeuraCommand(command);
                
                terminalInput.value = ''; terminalInput.focus();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (terminalHistoryIndex > 0) {
                    terminalHistoryIndex--; terminalInput.value = terminalHistory[terminalHistoryIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (terminalHistoryIndex < terminalHistory.length - 1) {
                    terminalHistoryIndex++; terminalInput.value = terminalHistory[terminalHistoryIndex];
                } else if (terminalHistoryIndex === terminalHistory.length - 1) {
                    terminalHistoryIndex = terminalHistory.length; terminalInput.value = '';
                }
            }
        });


        // --- [REAL] FILE EXPLORER (connects to main.js) ---
        let currentPath = ''; // Start at the user's home directory
        let pathHistory = [''];
        let historyIndexFE = 0;
        let selectedFile = null; 
        
        const filesListContent = document.getElementById('files-list-content');
        const filesBreadcrumb = document.getElementById('files-breadcrumb');
        const filesBackBtn = document.getElementById('files-back-btn');
        const filesForwardBtn = document.getElementById('files-forward-btn');
        const filesNewFolderBtn = document.getElementById('files-new-folder-btn');
        const filesDeleteBtn = document.getElementById('files-delete-btn');

        function getFileIcon(type) {
            if (type === 'folder') return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>`;
            return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>`;
        }
        function updatePathAndHistory(newPath, isHistory = false) {
            currentPath = newPath;
            if (!isHistory) {
                pathHistory = pathHistory.slice(0, historyIndexFE + 1);
                pathHistory.push(currentPath);
                historyIndexFE = pathHistory.length - 1;
            }
            renderFiles();
        }
        async function renderFiles() {
            if (!filesListContent || !filesBreadcrumb) return;
            selectedFile = null; if(filesDeleteBtn) filesDeleteBtn.disabled = true;
            filesListContent.innerHTML = 'Loading...'; 
            
            const result = await window.electronAPI.browseDirectory(currentPath);

            if (!result.success) {
                filesListContent.innerHTML = `<span style="color: red; padding: 10px;">Error: ${result.error}</span>`;
                return;
            }
            
            filesListContent.innerHTML = '';
            const files = result.files;

            const pathSegments = ['Home', ...currentPath.split('/').filter(s => s)];
            let html = '';
            let currentBreadcrumbPath = '';
            
            pathSegments.forEach((segment, index) => {
                if (index > 0) { currentBreadcrumbPath += (index === 1 ? '' : '/') + segment; }
                const data_path = (index === 0) ? '' : currentBreadcrumbPath;
                html += `<span data-path="${data_path}">${segment}</span>`;
            });
            filesBreadcrumb.innerHTML = html;

            if (files.length === 0) filesListContent.innerHTML = `<span style="padding: 10px; color: var(--c-text-secondary);">Folder is empty.</span>`;
            
            files.forEach(file => {
                const name = file.name, type = file.type;
                const item = document.createElement('div');
                item.className = 'file-item';
                item.setAttribute('data-type', type); item.setAttribute('data-name', name);
                item.innerHTML = getFileIcon(type) + `<span>${name}</span>`;
                
                item.addEventListener('click', () => {
                    document.querySelectorAll('.file-item.is-selected').forEach(el => el.classList.remove('is-selected'));
                    item.classList.add('is-selected');
                    selectedFile = name;
                    if(filesDeleteBtn) filesDeleteBtn.disabled = false;
                });
                if (type === 'folder') {
                    item.addEventListener('dblclick', () => {
                        const newPath = [currentPath, name].filter(Boolean).join('/');
                        updatePathAndHistory(newPath);
                    });
                } else {
                    // --- [FIX] THIS IS THE REAL FILE OPENER ---
                    item.addEventListener('dblclick', async () => {
                        const fileToOpen = [currentPath, name].filter(Boolean).join('/');
                        const result = await window.electronAPI.openFile(fileToOpen);
                        if (!result.success) {
                            osMessage("Error", `Could not open file: ${result.error}`);
                        }
                    });
                }
                filesListContent.appendChild(item);
            });
            
            if (filesBackBtn) filesBackBtn.disabled = historyIndexFE === 0;
            if (filesForwardBtn) filesForwardBtn.disabled = historyIndexFE === pathHistory.length - 1;
        }
        function navigateBack() {
            if (historyIndexFE > 0) { historyIndexFE--; updatePathAndHistory(pathHistory[historyIndexFE], true); }
        }
        function navigateForward() {
            if (historyIndexFE < pathHistory.length - 1) { historyIndexFE++; updatePathAndHistory(pathHistory[historyIndexFE], true); }
        }
        if (filesBackBtn) filesBackBtn.addEventListener('click', navigateBack);
        if (filesForwardBtn) filesForwardBtn.addEventListener('click', navigateForward);
        if (filesBreadcrumb) filesBreadcrumb.addEventListener('click', (e) => {
            if (e.target.tagName === 'SPAN' && e.target.hasAttribute('data-path')) {
                updatePathAndHistory(e.target.getAttribute('data-path'));
            }
        });
        
        if (filesNewFolderBtn) {
            filesNewFolderBtn.addEventListener('click', async () => {
                const folderName = prompt("Enter new folder name:", "New Folder");
                if (folderName) {
                    const newFolderPath = [currentPath, folderName].filter(Boolean).join('/');
                    const result = await window.electronAPI.createFolder(newFolderPath);
                    if (result.success) { renderFiles(); }
                    else { osMessage("Error", `Could not create folder: ${result.error}`); }
                }
            });
        }
        if (filesDeleteBtn) {
            filesDeleteBtn.addEventListener('click', async () => {
                if (!selectedFile) { osMessage("Error", "No file or folder selected."); return; }
                if (confirm(`Are you sure you want to move "${selectedFile}" to your Mac's Bin?`)) {
                    const itemPath = [currentPath, selectedFile].filter(Boolean).join('/');
                    const result = await window.electronAPI.deleteItem(itemPath);
                    if (result.success) { renderFiles(); }
                    else { osMessage("Error", `Could not delete item: ${result.error}`); }
                }
            });
        }
        function initFileExplorer() {
            currentPath = ''; // Start at home
            pathHistory = ['']; historyIndexFE = 0;
            renderFiles();
        }
        
        
        // --- [REAL] BROWSER LOGIC ---
        const browserView = document.getElementById('browser-view');
        const browserUrlBar = document.getElementById('browser-url-bar');
        const browserBack = document.getElementById('browser-back');
        const browserForward = document.getElementById('browser-forward');

        function initBrowser() {
            if (!browserView) return;
            
            browserUrlBar.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    let url = browserUrlBar.value;
                    if (!url.startsWith('http')) {
                        if (!url.includes('.')) {
                            url = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
                        } else {
                            url = 'https://' + url;
                        }
                    }
                    browserView.loadURL(url);
                }
            });

            browserBack.addEventListener('click', () => browserView.goBack());
            browserForward.addEventListener('click', () => browserView.goForward());

            browserView.addEventListener('did-navigate', (e) => {
                browserUrlBar.value = e.url;
            });
            browserView.addEventListener('did-start-loading', () => {
                browserUrlBar.value = "Loading...";
            });
            browserView.addEventListener('did-stop-loading', () => {
                browserUrlBar.value = browserView.getURL();
                browserBack.disabled = !browserView.canGoBack();
                browserForward.disabled = !browserView.canGoForward();
            });
            browserView.addEventListener('did-fail-load', (e) => {
                console.error("Browser failed to load:", e);
                browserUrlBar.value = "Failed to load";
            });
        }
        
        // --- Final initialization calls ---
        initWallpaperSettings(); 
        initTerminal();
        setDockActiveState();

    }); // <-- END OF DOMContentLoaded
</script>
</body>

</html>